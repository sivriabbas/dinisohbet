<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - DiniSohbet</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/main-styles.css">
    <link rel="stylesheet" href="/css/new-styles.css">
    <link rel="stylesheet" href="/css/offline.css">
</head>
<body>
    <%- include('../partials/navbar') %>

    <main class="main-content">
        <div class="offline-hero">
            <div class="container">
                <h1>
                    <i class="fas fa-cloud-download-alt"></i>
                    Offline Mod YÃ¶netimi
                </h1>
                <p>
                    Ä°Ã§erikleri offline kullanÄ±m iÃ§in indirin ve yÃ¶netin
                </p>
                <div id="onlineStatus" class="online-status online">
                    <i class="fas fa-wifi"></i> Ã‡evrimiÃ§i
                </div>
            </div>
        </div>

        <div class="offline-container">
            <!-- Offline Stats -->
            <div id="offlineStats" class="offline-stats">
                <div class="stat-item">
                    <i class="fas fa-book-quran"></i>
                    <div>
                        <div class="stat-value">0</div>
                        <div class="stat-label">Kuran Sure</div>
                    </div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-scroll"></i>
                    <div>
                        <div class="stat-value">0</div>
                        <div class="stat-label">Hadis</div>
                    </div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-hands-praying"></i>
                    <div>
                        <div class="stat-value">0</div>
                        <div class="stat-label">Dua</div>
                    </div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-database"></i>
                    <div>
                        <div class="stat-value">0 MB</div>
                        <div class="stat-label">KullanÄ±lan Alan</div>
                    </div>
                </div>
            </div>

            <!-- Download Section -->
            <section class="download-section">
                <h2><i class="fas fa-download"></i> Ä°Ã§erik Ä°ndirme</h2>
                <p>AÅŸaÄŸÄ±daki iÃ§erikleri offline kullanÄ±m iÃ§in cihazÄ±nÄ±za indirin</p>

                <div class="download-grid">
                    <!-- Quran Download -->
                    <div class="download-card">
                        <i class="fas fa-book-quran"></i>
                        <h3>Kuran-Ä± Kerim</h3>
                        <p>TÃ¼m 114 sure ve ayetleri TÃ¼rkÃ§e meal ile birlikte indirin</p>
                        <button class="btn-download" onclick="downloadQuranForOffline()">
                            <i class="fas fa-download"></i> Kuran'Ä± Ä°ndir
                        </button>
                    </div>

                    <!-- Hadith Download -->
                    <div class="download-card">
                        <i class="fas fa-scroll"></i>
                        <h3>Hadis Koleksiyonu</h3>
                        <p>1000+ hadis 6 temel kaynaktan (Buhari, MÃ¼slim, vb.)</p>
                        <button class="btn-download" onclick="downloadHadithsForOffline()">
                            <i class="fas fa-download"></i> Hadisleri Ä°ndir
                        </button>
                    </div>

                    <!-- Dua Download -->
                    <div class="download-card">
                        <i class="fas fa-hands-praying"></i>
                        <h3>Dua Koleksiyonu</h3>
                        <p>GÃ¼nlÃ¼k dualar, namaz dualarÄ± ve Ã¶zel dualar</p>
                        <button class="btn-download" onclick="downloadDuasForOffline()">
                            <i class="fas fa-download"></i> DualarÄ± Ä°ndir
                        </button>
                    </div>
                </div>
            </section>

            <!-- Management Section -->
            <section class="management-section">
                <h2><i class="fas fa-cogs"></i> Veri YÃ¶netimi</h2>
                <p>Offline verilerinizi yÃ¶netin ve senkronize edin</p>

                <div class="management-actions">
                    <button class="btn-manage btn-sync" onclick="offlineManager.syncOfflineActions()">
                        <i class="fas fa-sync"></i> Åžimdi Senkronize Et
                    </button>
                    <button class="btn-manage btn-clear" onclick="clearAllOfflineData()">
                        <i class="fas fa-trash"></i> TÃ¼m Verileri Temizle
                    </button>
                </div>

                <!-- Storage Info -->
                <div class="storage-info">
                    <h3><i class="fas fa-hdd"></i> Depolama KullanÄ±mÄ±</h3>
                    <div class="storage-bar">
                        <div class="storage-bar-fill" id="storageBarFill" style="width: 0%">
                            0%
                        </div>
                    </div>
                    <div class="storage-details">
                        <span id="storageUsed">KullanÄ±lan: 0 MB</span>
                        <span id="storageQuota">Toplam: 0 MB</span>
                    </div>
                </div>

                <!-- Sync Queue -->
                <div class="sync-queue">
                    <h3>
                        <i class="fas fa-clock"></i> 
                        Bekleyen Senkronizasyonlar
                        <span id="syncQueueCount" style="margin-left: 10px; color: var(--text-muted); font-size: 0.9rem;">(0)</span>
                    </h3>
                    <div id="syncQueueList">
                        <p style="color: var(--text-muted); text-align: center; padding: 20px;">
                            Bekleyen senkronizasyon yok
                        </p>
                    </div>
                </div>
            </section>

            <!-- Features Section -->
            <section class="features-section">
                <h2><i class="fas fa-star"></i> Offline Mod Ã–zellikleri</h2>

                <div class="features-grid">
                    <div class="feature-card">
                        <i class="fas fa-wifi-slash feature-icon"></i>
                        <div class="feature-content">
                            <h3>Ä°nternet BaÄŸlantÄ±sÄ± Gerektirmez</h3>
                            <p>Ä°ndirdiÄŸiniz iÃ§eriklere internet olmadan eriÅŸebilirsiniz</p>
                        </div>
                    </div>

                    <div class="feature-card">
                        <i class="fas fa-database feature-icon"></i>
                        <div class="feature-content">
                            <h3>Yerel Depolama</h3>
                            <p>Veriler cihazÄ±nÄ±zda gÃ¼venli bir ÅŸekilde saklanÄ±r</p>
                        </div>
                    </div>

                    <div class="feature-card">
                        <i class="fas fa-sync feature-icon"></i>
                        <div class="feature-content">
                            <h3>Otomatik Senkronizasyon</h3>
                            <p>BaÄŸlantÄ± saÄŸlandÄ±ÄŸÄ±nda offline iÅŸlemleriniz otomatik senkronize edilir</p>
                        </div>
                    </div>

                    <div class="feature-card">
                        <i class="fas fa-rocket feature-icon"></i>
                        <div class="feature-content">
                            <h3>HÄ±zlÄ± EriÅŸim</h3>
                            <p>Ä°ndirilen iÃ§eriklere anÄ±nda eriÅŸim saÄŸlayÄ±n</p>
                        </div>
                    </div>

                    <div class="feature-card">
                        <i class="fas fa-mobile-alt feature-icon"></i>
                        <div class="feature-content">
                            <h3>Mobil Uyumlu</h3>
                            <p>TÃ¼m cihazlarÄ±nÄ±zda sorunsuz Ã§alÄ±ÅŸÄ±r</p>
                        </div>
                    </div>

                    <div class="feature-card">
                        <i class="fas fa-shield-alt feature-icon"></i>
                        <div class="feature-content">
                            <h3>GÃ¼venli ve Ã–zel</h3>
                            <p>Verileriniz yalnÄ±zca sizin cihazÄ±nÄ±zda saklanÄ±r</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Instructions Section -->
            <section class="features-section" style="margin-top: 30px;">
                <h2><i class="fas fa-info-circle"></i> NasÄ±l KullanÄ±lÄ±r?</h2>

                <div style="padding: 20px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05)); border-radius: 10px;">
                    <ol style="color: var(--text); line-height: 2; padding-left: 20px;">
                        <li><strong>Ä°Ã§erik Ä°ndirin:</strong> YukarÄ±daki butonlarÄ± kullanarak istediÄŸiniz iÃ§erikleri indirin</li>
                        <li><strong>Offline KullanÄ±n:</strong> Ä°nternet baÄŸlantÄ±sÄ± olmadan indirdiÄŸiniz iÃ§eriklere eriÅŸin</li>
                        <li><strong>Senkronize Edin:</strong> Ä°nternet baÄŸlantÄ±sÄ± saÄŸlandÄ±ÄŸÄ±nda offline yaptÄ±ÄŸÄ±nÄ±z iÅŸlemler otomatik olarak senkronize edilir</li>
                        <li><strong>DepolamayÄ± YÃ¶netin:</strong> GerektiÄŸinde eski verileri temizleyerek yer aÃ§abilirsiniz</li>
                    </ol>

                    <div style="margin-top: 20px; padding: 15px; background: rgba(255, 152, 0, 0.1); border-left: 4px solid #ff9800; border-radius: 5px;">
                        <p style="margin: 0; color: var(--text);"><strong>ðŸ’¡ Ä°pucu:</strong> TÃ¼m Kuran'Ä± indirmek yaklaÅŸÄ±k 5-10 MB yer kaplar. Hadis koleksiyonu ise yaklaÅŸÄ±k 2-3 MB'dÄ±r.</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <%- include('../partials/footer') %>

    <script src="/js/offline.js"></script>
    <script>
        // Update stats on page load
        document.addEventListener('DOMContentLoaded', async function() {
            // Wait for offline manager to initialize
            setTimeout(async () => {
                if (window.offlineManager) {
                    await updateOfflineStats();
                    await updateStorageInfo();
                    await updateSyncQueue();
                }
            }, 500);
        });

        async function updateStorageInfo() {
            if (!window.offlineManager) return;

            const storageInfo = await offlineManager.getStorageInfo();
            if (storageInfo) {
                const barFill = document.getElementById('storageBarFill');
                const usedElement = document.getElementById('storageUsed');
                const quotaElement = document.getElementById('storageQuota');

                barFill.style.width = storageInfo.percentage + '%';
                barFill.textContent = storageInfo.percentage + '%';
                usedElement.textContent = `KullanÄ±lan: ${storageInfo.usageInMB} MB`;
                quotaElement.textContent = `Toplam: ${storageInfo.quotaInMB} MB`;
            }
        }

        async function updateSyncQueue() {
            if (!window.offlineManager) return;

            const count = await offlineManager.getCachedCount('syncQueue');
            const countElement = document.getElementById('syncQueueCount');
            
            if (countElement) {
                countElement.textContent = `(${count})`;
            }
        }

        // Refresh stats every 10 seconds
        setInterval(() => {
            if (window.offlineManager) {
                updateOfflineStats();
                updateStorageInfo();
                updateSyncQueue();
            }
        }, 10000);
    </script>
</body>
</html>
